<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
    <title>Карта Генплан api v2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://api-maps.yandex.ru/2.0/?load=package.standard&lang=ru-RU" type="text/javascript"></script>
    <script src="tiler-converter.js" type="text/javascript"></script>

    <script type="text/javascript">
        var contentString = new Array(
                ['Домбасова 1a', '<div umi:element-id="1331" class="show-items-info" id="1331" style="top: 275px; left: 486px;"><img src="/images/cms/data/catalog/12.jpg" alt=""><div class="description-house"><p class="status"><span>Сотояния:</span><span color="1716">Продан</span></p><p class="plowad"><span>Площадь: </span>5,05</p><p class="stoimost"><span>Стоимость: </span></p></div></div>', 51.7467985845738, 39.050852865736, 'map-ymap-api2x.html', ''],
                ['Домбасова 2a', '<div umi:element-id="1331" class="show-items-info" id="1331" style="top: 275px; left: 486px;"><img src="/images/cms/data/catalog/12.jpg" alt=""><div class="description-house"><p class="status"><span>Сотояния:</span><span color="1716">Продан</span></p><p class="plowad"><span>Площадь: </span>5,05</p><p class="stoimost"><span>Стоимость: </span></p></div></div>', 51.7467085845738, 39.051022865736, 'map-ymap-api2x.html', ''],
                ['Домбасова 3a', '<div umi:element-id="1331" class="show-items-info" id="1331" style="top: 275px; left: 486px;"><img src="/images/cms/data/catalog/12.jpg" alt=""><div class="description-house"><p class="status"><span>Сотояния:</span><span color="1716">Продан</span></p><p class="plowad"><span>Площадь: </span>5,05</p><p class="stoimost"><span>Стоимость: </span></p></div></div>', 51.7467085845738, 39.051022865736, 'map-ymap-api2x.html', '']
        );
        var options = {
            tileUrlTemplate: "./%z/tile-%x-%y.png",
            controls: {
                typeControl: false,
                miniMap: false,
                toolBar: true,
                scaleLine: true
            },
            scrollZoomEnabled: true,
            mapCenter: new YMaps.GeoPoint(39.053422865736, 51.7455485845738),
            backgroundMapType: YMaps.MapType.NONE,
            mapZoom: 17,
            isTransparent: true,
            smoothZooming: false,
            layerKey: "my#layer",
            mapType: {
                name: "Генплан",
                textColor: "#000000"
            },
            copyright: "",
            layerMinZoom: 16,
            layerMaxZoom: 20
        };

        ymaps.ready(function () {
            // Передаем его в конструктор класса TilerConverter и получаем ссылку на карту.
            var myMap = (new TilerConverter(options)).getMap();
            //создаём точки
            for (var i = 0; i < contentString.length; i++) {
                contentString[i][5] = new ymaps.Placemark([contentString[i][2], contentString[i][3]], {
                            balloonContentHeader: contentString[i][0],
                            balloonContentBody: contentString[i][1],
                            balloonContentFooter: "<a href='" + contentString[i][4] + "'>подробней</a>",
                            hintContent: contentString[i][0]
                        }, {
                            hideIcon: true,
                            /*
                             hideIcon: true,
                             iconImageHref: 'icon.png', // картинка иконки
                             iconImageSize: [12, 20], // размеры картинки
                             iconImageOffset: [-6, -10], // смещение картинки*/
                            openEmptyBalloon: true
                        }
                );
                myMap.geoObjects.add(contentString[i][5]);
            };


            // Показываем хинт на карте (без привязки к геообъекту).
            myMap.hint.show(myMap.getCenter(), "Содержимое хинта", {
                // Опция: задержка перед открытием.
                showTimeout: 1500
            });

            if ($("ymaps").length != 0){
                var nameTimeout = setTimeout(function () {
                    stosis();
                    setInterval(function () {
                        clearTimeout(nameTimeout);
                        stosis();
                    }, 200);
                }, 3000);
            }

            function stosis() {
                var position = $('.ymaps-b-zoom__mark').position();
                if (position.top=='3'){
                    var width = $('.ymaps-layers-pane').width();
                    var height = $('.ymaps-layers-pane').height();
                    console.log('width ' + width + 'height '+height);
                } else {
                    if (position.top=='10'){
                        console.log('zoom = 2');
                    } else {
                        if (position.top=='17'){
                            console.log('zoom = 3');
                        } else {
                            if (position.top=='24'){
                                console.log('zoom = 4');
                            } else {
                                if (position.top=='31'){
                                    console.log('zoom = 5');
                                } else {
                                    console.log('zoom = error');
                                }
                            }
                        }
                    }
                }
            }

        });



    </script>
    <style type="text/css">
        #YMapsID {
            width: 800px;
            height: 600px;

        }

        #YMapsID > ymaps {
            background: url("bg.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
        }

        #YMapsID .ymaps-copyrights-pane,
        #YMapsID .ymaps-controls-rightbottom {
            display: none;
        }

        .ymaps-b-zoom__mark-inner {
            /*в зависиости от того на сколько сверху отступ то и разные ограничения*/
        }

        .ymaps-layers-pane {
            /*этот элемнт нельзя больше по высоте и в бок двигать*/
        }

        .show-items-info {
            background: none repeat scroll 0 0 rgba(253, 250, 243, 0.8);
            left: 0;
            padding: 15px;
            top: 0;
            width: 250px;
            z-index: 19;
        }

        .ymaps-image-with-content {
            visibility: visible
        }

        .ymaps-image-with-content:hover {
            visibility: visible
        }
    </style>
</head>
<body>
<div id="YMapsID"></div>
</body>
</html>